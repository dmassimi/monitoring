[SERVICE]
    Flush         1
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    
[INPUT]
    Name          tail
    Tag           docker.*
    # This path must match the mounted path in docker-compose.yaml
    Path          /var/lib/docker/containers/*/*-json.log
    DB            /var/log/flb_tail.db
    Parser        docker
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On
    
# --- FILTER: Essential for Docker log parsing and making records structured ---
[FILTER]
    Name          parser
    Match         docker.*
    Key_Name      log
    Parser        json
    Reserve_Data  On

# --- OUTPUT: Send OTLP Logs to the OTEL Collector ---
[OUTPUT]
    Name          opentelemetry 
    Match         *
    Host          otel_collector     
    Port          4318             
    logs_uri      /v1/logs
    
    # CRITICAL FIX: Use add_label for older plugins instead of 'Resource' block
    # This injects the service name as a label, which the Collector can promote to a Resource attribute.
    add_label     service.name bwce-logs-via-otel-collector 
    
    Log_Response_Payload true